digraph MatmulComputeGraph {
    rankdir=TB;
    bgcolor="white";
    pad=0.5;
    dpi=300;

    // Graph styling
    node [fontname="Arial", fontsize=11, style="filled,rounded", shape=box];
    edge [fontname="Arial", fontsize=9];

    // Title
    label="Compute Graph: L[M,K] @ R[K,N] = Output[M,N]\nTiling: 2x2 tiles for MxN\nEdge labels show tensor indices: axis:(start,end)";
    labelloc="t";
    fontsize=14;
    fontname="Arial Bold";

    // Define subgraphs
    subgraph cluster_0 {
        label="Subgraph 0\n(M_tile=0, N_tile=0)";

        alloc_L_0 [label="L_sbuf_0 =\nndarray(...)", fillcolor="#E8E8E8"];
        alloc_R_0 [label="R_sbuf_0 =\nndarray(...)", fillcolor="#E8E8E8"];
        alloc_out_0 [label="out_sbuf_0 =\nndarray(...)", fillcolor="#E8E8E8"];
        load_L_0 [label="load(L[0, :],\ndst=L_sbuf_0)", fillcolor="#FFEAA7"];
        load_R_0 [label="load(R[:, 0],\ndst=R_sbuf_0)", fillcolor="#FFEAA7"];
        compute_0 [label="matmul(L_sbuf_0,\nR_sbuf_0, out_sbuf_0)", fillcolor="#A8D8EA"];
        store_0 [label="store(out_sbuf_0,\ndst=Output[0,0])", fillcolor="#A8E6CF"];

        alloc_L_0 -> load_L_0 [label="L_sbuf_0\nbuf:(0->1) M:(0->1) K:(0->1)", color="#666666"];
        alloc_R_0 -> load_R_0 [label="R_sbuf_0\nbuf:(0->1) K:(0->1) N:(0->1)", color="#666666"];
        alloc_out_0 -> compute_0 [label="out_sbuf_0\nbuf:(0->1) M:(0->1) N:(0->1)", color="#666666"];
        load_L_0 -> compute_0 [label="L_sbuf_0\nbuf:(0->1) M:(0->1) K:(0->1)", color="#666666"];
        load_R_0 -> compute_0 [label="R_sbuf_0\nbuf:(0->1) K:(0->1) N:(0->1)", color="#666666"];
        compute_0 -> store_0 [label="out_sbuf_0\nbuf:(0->1) M:(0->1) N:(0->1)", color="#666666"];
    }

    subgraph cluster_1 {
        label="Subgraph 1\n(M_tile=0, N_tile=1)";

        alloc_L_1 [label="L_sbuf_1 =\nndarray(...)", fillcolor="#E8E8E8"];
        alloc_R_1 [label="R_sbuf_1 =\nndarray(...)", fillcolor="#E8E8E8"];
        alloc_out_1 [label="out_sbuf_1 =\nndarray(...)", fillcolor="#E8E8E8"];
        load_L_1 [label="load(L[0, :],\ndst=L_sbuf_1)", fillcolor="#FFEAA7"];
        load_R_1 [label="load(R[:, 1],\ndst=R_sbuf_1)", fillcolor="#FFEAA7"];
        compute_1 [label="matmul(L_sbuf_1,\nR_sbuf_1, out_sbuf_1)", fillcolor="#A8D8EA"];
        store_1 [label="store(out_sbuf_1,\ndst=Output[0,1])", fillcolor="#A8E6CF"];

        alloc_L_1 -> load_L_1 [label="L_sbuf_1\nbuf:(0->1) M:(0->1) K:(0->1)", color="#666666"];
        alloc_R_1 -> load_R_1 [label="R_sbuf_1\nbuf:(0->1) K:(0->1) N:(1->2)", color="#666666"];
        alloc_out_1 -> compute_1 [label="out_sbuf_1\nbuf:(0->1) M:(0->1) N:(1->2)", color="#666666"];
        load_L_1 -> compute_1 [label="L_sbuf_1\nbuf:(0->1) M:(0->1) K:(0->1)", color="#666666"];
        load_R_1 -> compute_1 [label="R_sbuf_1\nbuf:(0->1) K:(0->1) N:(1->2)", color="#666666"];
        compute_1 -> store_1 [label="out_sbuf_1\nbuf:(0->1) M:(0->1) N:(1->2)", color="#666666"];
    }

    subgraph cluster_2 {
        label="Subgraph 2\n(M_tile=1, N_tile=0)";

        alloc_L_2 [label="L_sbuf_2 =\nndarray(...)", fillcolor="#E8E8E8"];
        alloc_R_2 [label="R_sbuf_2 =\nndarray(...)", fillcolor="#E8E8E8"];
        alloc_out_2 [label="out_sbuf_2 =\nndarray(...)", fillcolor="#E8E8E8"];
        load_L_2 [label="load(L[1, :],\ndst=L_sbuf_2)", fillcolor="#FFEAA7"];
        load_R_2 [label="load(R[:, 0],\ndst=R_sbuf_2)", fillcolor="#FFEAA7"];
        compute_2 [label="matmul(L_sbuf_2,\nR_sbuf_2, out_sbuf_2)", fillcolor="#A8D8EA"];
        store_2 [label="store(out_sbuf_2,\ndst=Output[1,0])", fillcolor="#A8E6CF"];

        alloc_L_2 -> load_L_2 [label="L_sbuf_2\nbuf:(0->1) M:(1->2) K:(0->1)", color="#666666"];
        alloc_R_2 -> load_R_2 [label="R_sbuf_2\nbuf:(0->1) K:(0->1) N:(0->1)", color="#666666"];
        alloc_out_2 -> compute_2 [label="out_sbuf_2\nbuf:(0->1) M:(1->2) N:(0->1)", color="#666666"];
        load_L_2 -> compute_2 [label="L_sbuf_2\nbuf:(0->1) M:(1->2) K:(0->1)", color="#666666"];
        load_R_2 -> compute_2 [label="R_sbuf_2\nbuf:(0->1) K:(0->1) N:(0->1)", color="#666666"];
        compute_2 -> store_2 [label="out_sbuf_2\nbuf:(0->1) M:(1->2) N:(0->1)", color="#666666"];
    }

    subgraph cluster_3 {
        label="Subgraph 3\n(M_tile=1, N_tile=1)";

        alloc_L_3 [label="L_sbuf_3 =\nndarray(...)", fillcolor="#E8E8E8"];
        alloc_R_3 [label="R_sbuf_3 =\nndarray(...)", fillcolor="#E8E8E8"];
        alloc_out_3 [label="out_sbuf_3 =\nndarray(...)", fillcolor="#E8E8E8"];
        load_L_3 [label="load(L[1, :],\ndst=L_sbuf_3)", fillcolor="#FFEAA7"];
        load_R_3 [label="load(R[:, 1],\ndst=R_sbuf_3)", fillcolor="#FFEAA7"];
        compute_3 [label="matmul(L_sbuf_3,\nR_sbuf_3, out_sbuf_3)", fillcolor="#A8D8EA"];
        store_3 [label="store(out_sbuf_3,\ndst=Output[1,1])", fillcolor="#A8E6CF"];

        alloc_L_3 -> load_L_3 [label="L_sbuf_3\nbuf:(0->1) M:(1->2) K:(0->1)", color="#666666"];
        alloc_R_3 -> load_R_3 [label="R_sbuf_3\nbuf:(0->1) K:(0->1) N:(1->2)", color="#666666"];
        alloc_out_3 -> compute_3 [label="out_sbuf_3\nbuf:(0->1) M:(1->2) N:(1->2)", color="#666666"];
        load_L_3 -> compute_3 [label="L_sbuf_3\nbuf:(0->1) M:(1->2) K:(0->1)", color="#666666"];
        load_R_3 -> compute_3 [label="R_sbuf_3\nbuf:(0->1) K:(0->1) N:(1->2)", color="#666666"];
        compute_3 -> store_3 [label="out_sbuf_3\nbuf:(0->1) M:(1->2) N:(1->2)", color="#666666"];
    }

}
